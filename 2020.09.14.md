# 1.2020.09.14  ä½ å¥½ï¼Œä¸–ç•Œ



> ä»Šå¤©æ˜¯å›åˆ°å…¬å¸çš„ç¬¬ä¸€å¤©ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆå§

1. é¦–å…ˆæ˜¯åˆ°å®¶çš„éœ€æ±‚ï¼Œä½†æ˜¯æˆ‘ç»å¤§å¤šæ•°çš„ä¸œè¥¿å¿˜è®°ï¼Œéœ€è¦å›å¿†ã€‚

   preç¯å¢ƒåšäº†ç™½åå•ï¼Œå› æ­¤æ•°æ®è®¿é—®æ”¶åˆ°äº†é™åˆ¶ï¼Œéœ€è¦å°†é¡¹ç›®æ”¾åˆ°æŒ‡å®šæœåŠ¡å™¨æ‰èƒ½è®¿é—®ï¼Œä¸ºäº†å¿«é€Ÿå“åº”ï¼Œæˆ‘ç›´æ¥è¿›è¡Œäº†ä¿®æ”¹å‘å¸ƒã€‚

   

2. ç„¶åæ˜¯å¯¹è´¦å•ï¼Œå¾·æ˜å’Œæˆ‘å¯¹æ¥ã€‚

   ![image-20200914151300090](/Users/juzelong/Library/Application Support/typora-user-images/image-20200914151300090.png)

â€‹        æ—¢æ˜¯å‘½è¿ï¼Œé‚£å°±ä¸è§ä¸æ•£ï¼



> å¾—åˆ°çš„ä¿¡æ¯æ˜¯è¿™ä¸ªé¡¹ç›®åŒäº‹è·Ÿäº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰å®è´¨æ€§çš„è¿›å±•ï¼Œæˆ‘ç°åœ¨ä¸»è¦çš„ç›®æ ‡æ˜¯å…ˆæŠŠé¡¹ç›®è·‘èµ·æ¥ï¼

1. å…ˆæŠŠmavençš„ä½ç½®åšå¥½

![image-20200914155240563](/Users/juzelong/Library/Application Support/typora-user-images/image-20200914155240563.png)

> ä¼šè®®çºªè¦

1. å¯¹è´¦å•å¸ä¸å¹³çš„ç§˜å¯†  -> å¸å¹³å³å¯
2. ç‡ƒæ°”äº‘ä¸šåŠ¡              -> ä¸Šçº¿æ–°ä¸œè¥¿
3. ç”µå•†                       -> è‡ªç»„ä¸€å¥—

> ç»“æŸè¯­

é¡¹ç›®ä¾ç„¶è·‘ä¸èµ·æ¥ï¼Œè¿™ç‚¹å¿…é¡»è®°ä¸‹

![image-20200914181115163](/Users/juzelong/Library/Application Support/typora-user-images/image-20200914181115163.png)



# 2020.09.15 å¯¹è´¦ä¸šåŠ¡

> å¸Œæœ›ä»Šå¤©èƒ½æŠŠé¡¹ç›®è·‘èµ·æ¥

![image-20200915094457874](/Users/juzelong/Library/Application Support/typora-user-images/image-20200915094457874.png)

è¿™ä¸ªé¡¹ç›®çš„åœ°å€ä¸€ç›´æ‰¾ä¸åˆ°ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šä»–ä»¬æ˜¯æ€ä¹ˆåšçš„ï¼Œæˆ–è®¸ä»–ä»¬çš„å†…ç½‘ç¯å¢ƒå¯ä»¥é“¾æ¥ï¼Ÿ

> ä¸»è¦å‘½ä»¤ è·³è¿‡æµ‹è¯•

```java
/Library/Java/JavaVirtualMachines/jdk1.8.0_221.jdk/Contents/Home/bin/java -Dmaven.multiModuleProjectDirectory=/Users/juzelong/project/vcc/gss -Dmaven.home=/Users/juzelong/project/maven/apache-maven-3.6.3 -Dclassworlds.conf=/Users/juzelong/project/maven/apache-maven-3.6.3/bin/m2.conf "-Dmaven.ext.class.path=/Applications/IntelliJ IDEA.app/Contents/plugins/maven/lib/maven-event-listener.jar" "-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=60825:/Applications/IntelliJ IDEA.app/Contents/bin" -Dfile.encoding=UTF-8 -classpath /Users/juzelong/project/maven/apache-maven-3.6.3/boot/plexus-classworlds.license:/Users/juzelong/project/maven/apache-maven-3.6.3/boot/plexus-classworlds-2.6.0.jar org.codehaus.classworlds.Launcher -Didea.version2020.1.1 -s /Users/juzelong/project/maven/apache-maven-3.6.3/conf/vcc-settings.xml -Dmaven.repo.local=/Users/juzelong/project/repository -DskipTests=true install

```



> é¡¹ç›®å¯ä»¥æ‰“åŒ…æˆåŠŸäº†ï¼Œä½†æ˜¯æˆ‘ä¾ç„¶ä¸çŸ¥é“æ•´ä¸ªæ­¥éª¤æ˜¯æ€æ ·çš„

## å¯¹è´¦ä¸šåŠ¡

1. **ç¼´è´¹æµç¨‹**

![img](/Users/juzelong/Documents/0.png)

2. **å¯¹è´¦æµç¨‹**

![img](/Users/juzelong/Documents/0-20200915153218928.png)

3. é€€è´¹æ–¹æ¡ˆ

   ![img](https://qqadapt.qpic.cn/txdocpic/0/fb34e592a64a365b61f2db79ff410d02/0?w=1288&h=1288&_type=png)

4. æºç è¯´æ˜![image-20200915153759344](/Users/juzelong/Documents/image-20200915153759344.png)
5. ![image-20200915153834582](/Users/juzelong/Documents/image-20200915153834582.png)
6.  

```
1. æ‰å¸(ReconciliatonCheckHandler)ï¼Œå¯¹è´¦æ—¶è¿œç¨‹ç¼“å­˜å¿…é¡»æœ‰æ•°æ®ï¼Œå¦åˆ™å¯¹è´¦å¤±è´¥æŠ›å¼‚å¸¸ã€‚ä»¥è¿œç¨‹å•ä¸ºå‡†è¿›è¡Œéå†æ‰å¸ï¼Œéå†æœ¬åœ°å•è¿›è¡Œé€ä¸€å¯¹è´¦ã€‚
2. è¿œç¨‹å•æ”¯ä»˜æˆåŠŸï¼šæ”¯ä»˜æµæ°´å·ç›¸ç­‰ï¼Ÿ
    - åŒ¹é…æ”¯ä»˜çŠ¶æ€ã€è´¦å•é‡‘é¢ï¼Œç»Ÿè®¡è¿œç¨‹è®¢å•æ•°é‡å’Œè¿œç¨‹è®¢å•æ€»é¢ï¼Œæœ¬åœ°è®¢å•æ•°é‡ï¼ˆå¤„ç†åˆå¹¶è®¢å•ï¼‰å’Œæœ¬åœ°è®¢å•é‡‘é¢ï¼ˆä¼˜æƒ å¡è®¢å•é‡‘é¢ï¼‰ï¼Œè®¾ç½®å¯¹è´¦æˆåŠŸï¼›
    - æ”¯ä»˜çŠ¶æ€åŒ¹é…ï¼Œé‡‘é¢ä¸åŒ¹é…ï¼Œç»Ÿè®¡è¿œç¨‹è®¢å•æ•°é‡å’Œè¿œç¨‹è®¢å•æ€»é¢ï¼Œæœ¬åœ°è®¢å•æ•°é‡ï¼ˆå¤„ç†åˆå¹¶è®¢å•ï¼‰å’Œæœ¬åœ°è®¢å•é‡‘é¢ï¼ˆä¼˜æƒ å¡è®¢å•é‡‘é¢ï¼‰ï¼Œè®¾ç½®å¯¹è´¦æ•°æ®å¼‚å¸¸ç­‰å¾…äººå·¥å¤„ç†æˆ–è€…å¯¹è´¦æˆåŠŸä¸éœ€è¦äººå·¥å¤„ç†ï¼›
3. è¿œç¨‹å•å·²é€€æ¬¾ï¼šé€€æ¬¾æµæ°´å·ä¸æœ¬åœ°é€€æ¬¾æµæ°´å·ç›¸åŒï¼Œæœ¬åœ°æ”¯ä»˜é‡‘é¢ä¸è¿œç¨‹é€€è´¹é‡‘é¢ç›¸ç­‰ï¼Ÿ
    - ç›¸ç­‰ï¼šè®¾ç½®å¯¹è´¦æˆåŠŸï¼Œç»Ÿè®¡é€€è´¹å•æ•°é‡å’Œé€€è´¹å•æ€»é¢ï¼Œæœ¬åœ°é€€è´¹å•é‡å’Œæœ¬åœ°é€€è´¹æ€»é¢ï¼ˆä¼˜æƒ å¡é€€è´¹æ€»é¢ï¼‰
    - ä¸ç­‰ï¼šè®¾ç½®å¯¹è´¦æ•°æ®å¼‚å¸¸ç­‰å¾…äººå·¥å¤„ç†æ ‡å¿—æˆ–è€…è®¾ç½®é€€è´¹æˆåŠŸæ ‡å¿—ï¼Œç»Ÿè®¡é€€è´¹å•æ•°é‡å’Œé€€è´¹å•æ€»é¢ï¼Œæœ¬åœ°é€€è´¹å•é‡å’Œæœ¬åœ°é€€è´¹æ€»é¢ï¼ˆä¼˜æƒ å¡é€€è´¹æ€»é¢ï¼‰
4. è¿œç¨‹å•æ”¯ä»˜å¤±è´¥ï¼šåŒ¹é…æ”¯ä»˜æµæ°´å·åï¼Œvccå°†æ”¯ä»˜çŠ¶æ€æ”¹ä¸ºå¤±è´¥ã€‚    
    
```

7. å¤„ç†å¯¹è´¦å¤±è´¥è´¦å• 

```
1. ç³»ç»Ÿé…ç½®æ˜¯å¦è‡ªåŠ¨å¹³è´¦ï¼Œå¦åˆ™å¯¹è´¦å•ä¸ºæ‰‹åŠ¨å¤„ç†ã€å¯¹è´¦å¤±è´¥
2. æŸ¥è¯¢ä¸Šä¸€æ­¥å¯¹è´¦å¤±è´¥çš„çš„å¯¹è´¦å•ï¼ˆReconciliation_stateä¸ºV/R)ï¼Œéå†å¯¹è´¦å•ï¼Œé’ˆå¯¹æ¯ä¸€æ¡å¤±è´¥å¯¹è´¦å•(ä¸æ”¯ä»˜å•ä¸€ä¸€å¯¹åº”)ï¼š
    - æ— æ”¯ä»˜å•Idåˆ™è¯´æ˜éœ€è¦å¯¹æ­¤ç¬”è¿›è¡Œè¡¥è´¦ï¼Œæç¤ºå³å¯
    - è‹¥ä¸º-å¹³å°å·²æ”¯ä»˜ï¼Œvccæœªæ”¯ä»˜-çŠ¶æ€ï¼Œåˆ™å°†å¯¹åº”æ”¯ä»˜å•å˜æ›´ä¸ºå·²æ”¯ä»˜ï¼Œä¸šåŠ¡çŠ¶æ€å˜æ›´ä¸ºå·²å®Œæˆï¼Œå¯¹è´¦çŠ¶æ€å˜æ›´ä¸ºå·²å®Œæˆï¼›è‹¥ä¸šåŠ¡ç±»å‹ä¸ºICå¡å……å€¼(æ°”é‡å……å€¼/é‡‘é¢å……å€¼)ï¼Œåˆ™è¦å¯¹è´¦æˆ·è¿›è¡Œè¡¥æ°”æˆ–è¡¥é‡‘é¢ï¼›
    - è‹¥ä¸º-å¹³å°å·²é€€è´¹ï¼Œvccå·²æ”¯ä»˜-çŠ¶æ€ï¼Œåˆ™å°†å¯¹åº”æ”¯ä»˜å•å˜æ›´ä¸ºå·²é€€è´¹ï¼Œä¸šåŠ¡çŠ¶æ€å˜æ›´ä¸ºå·²é€€è´¹ï¼›è‹¥ä¸šåŠ¡ç±»å‹ä¸ºICå¡å……å€¼(æ°”é‡å……å€¼/é‡‘é¢å……å€¼)ï¼Œåˆ™è¦æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ææ°”ï¼Œæœªææ°”åˆ™æŸ¥è¯¢ä½™é¢ï¼Œä½™é¢è¶³å¤Ÿåˆ™æ°”é‡å†²æ­£ï¼Œå¦åˆ™åˆ¤æ–­æ˜¯å¦å†»ç»“ï¼Œè‹¥å†»ç»“åˆ™è§£å†»é€€æ°”å†²æ­£ï¼Œå¦åˆ™æ ‡è®°äººå·¥å¤„ç†ï¼›å·²ææ°”åˆ™æ ‡è®°äººå·¥å¤„ç†ï¼›
```

> ç»“æŸè¯­ï¼š ä¸ç®¡æ˜¯javaè¿˜æ˜¯ä¸šåŠ¡ï¼Œéƒ½æ˜¯ä¸€å¤´é›¾æ°´ï¼Œå¾ˆéš¾ææ¸…æ¥šæ¥é¾™å»è„‰ï¼Œè¿™å¯¹æˆ‘è€Œè¨€çš„ç¡®ç®—æ˜¯ä¸ªæŒ‘æˆ˜



# 2020.09.15 javaåå°„

## å…³äºjavaä¸­çš„ä¸€äº›åå°„æ¦‚å¿µ

> ç”±äºçŸ¥é“ä¸šåŠ¡çš„äººä¸‹å‘¨æ‰èƒ½å›æ¥ï¼Œæˆ‘è§‰å¾—éœ€è¦å·©å›ºä¸€ä¸‹æˆ‘å¯¹javaçš„çŸ¥è¯†

```java


import java.lang.annotation.*;
import java.lang.reflect.*;
import java.util.List;
import java.util.Map;

public class test3 {

    public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException {
        //å–å¾—åå°„ç±»
        Class<?> user = Class.forName("User");
        user.getName();
        System.out.println(user);
        //è·å–æ‰€æœ‰å±æ€§
        Field[] declaredFields = user.getDeclaredFields();
        for (Field declaredField : declaredFields) {
            System.out.println(declaredField);
        }

        //è·å¾—åŒ…æ‹¬çˆ¶ç±»çš„æ‰€æœ‰publicæ–¹æ³•
        Method[] methods = user.getMethods();
        for (Method method : methods) {
            System.out.println(method);
        }
        //è·å¾—æ‰€æœ‰æœ¬ç±»çš„æ–¹æ³•
        Method[] declaredMethods = user.getDeclaredMethods();
        for (Method declaredMethod : declaredMethods) {
            System.out.println(declaredMethod);
        }

        //è·å–æŒ‡å®špublicæ–¹æ³• åé¢çš„å‚æ•°æ˜¯å…¥å‚
        Method method = user.getMethod("getName", null);
        System.out.println(method);
        //è·å–æ‰€æœ‰æ–¹æ³•
        Method method2 = user.getDeclaredMethod("getName", null);
        System.out.println(method2);

        //é€šè¿‡æ„é€ å™¨è·å–ç±»
        Class<?> user2 = Class.forName("User");
        Constructor<?> constructor = user2.getConstructor(String.class, int.class, int.class);
        User jzl = (User)constructor.newInstance("å±…æ³½é¾™", 18, 18);
        System.out.println(jzl);

        //è°ƒç”¨æ–¹æ³•
        Class<?> c1 = Class.forName("User");
        User user3 = (User)c1.newInstance();
        Method setNames = c1.getDeclaredMethod("setName", String.class);
        Method setAge = c1.getDeclaredMethod("setAge", int.class);
        Method setId = c1.getDeclaredMethod("setId", int.class);
        setNames.invoke(user3, "å±…æ³½é¾™");
        setAge.invoke(user3, 1);
        setId.invoke(user3, 2);
        System.out.println(user3.getName());


        Method getNameAndAge = c1.getDeclaredMethod("getNameAndAge", null);
        //ç§æœ‰æ–¹æ³•å¼€å…³
        getNameAndAge.setAccessible(true);
        int i = (int)getNameAndAge.invoke(user3, null);
        System.out.println(i);


        //è·å–ç»“æ„åŒ–å…¥å‚å’Œè¿”å›å€¼
        Method method5 = User.class.getMethod("test01", Map.class, List.class);

        Type[] genericParameterTypes = method5.getGenericParameterTypes();
        for (Type genericParameterType : genericParameterTypes) {
            System.out.println("#" + genericParameterType);
            if (genericParameterType instanceof ParameterizedType) {
                Type[] actualTypeArguments = ((ParameterizedType) genericParameterType).getActualTypeArguments();
                for (Type actualTypeArgument : actualTypeArguments) {
                    System.out.println(actualTypeArgument);
                }
            }
        }
        Type genericReturnType = method5.getGenericReturnType();
        if (genericReturnType instanceof ParameterizedType) {
            Type[] actualTypeArguments = ((ParameterizedType) genericReturnType).getActualTypeArguments();
            for (Type actualTypeArgument : actualTypeArguments) {
                System.out.println(actualTypeArgument);
            }
        }


        //è·å–æ³¨è§£
        Class user1 = Class.forName("User");
        Annotation[] annotations = user1.getAnnotations();
        for (Annotation annotation : annotations) {
            System.out.println(annotation);
        }

        TableJ annotation = (TableJ)user1.getAnnotation(TableJ.class);
        System.out.println(annotation.value());

        Field name = user1.getDeclaredField("name");

        Fieldj annotation1 = name.getAnnotation(Fieldj.class);

        System.out.println(annotation1.columnName());
        System.out.println(annotation1.type());
        System.out.println(annotation1.length());

    }
}

@TableJ(value = "ju")
class User {
    @Fieldj(columnName = "name", type= "varchar", length = 10)
    private String name;
    @Fieldj(columnName = "age", type= "int", length = 10)
    private int age;
    @Fieldj(columnName = "id", type= "int", length = 10)
    private int id;

    public User() {
    }

    public User(String name, int age, int id) {
        this.name = name;
        this.age = age;
        this.id = id;
    }

    private int getNameAndAge() {
        return this.age + this.id;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public int getId() {
        return id;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public void setId(int id) {
        this.id = id;
    }

    @Override
    public String toString() {
        return "User{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", id=" + id +
                '}';
    }

    public Map<String, User> test01(Map<String, User> map, List<User> list) {
        return null;
    }

}


//ç±»åæ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@interface TableJ{
    String value();
}

//å±æ€§æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@interface Fieldj{
    String columnName();
    String type();
    int length();
}
```

> è§†é¢‘çœ‹å®Œäº†ï¼Œæ€»ä½“çš„æ„Ÿè§‰è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨æ¥å†™æ¡†æ¶ï¼Œåšåˆ°æŠ½è±¡å’Œå½’ä¸€åŒ–å¤„ç†ã€‚



> çœ‹ä¸€ä¸‹ä¸šåŠ¡ä»£ç çš„ä¸»è¦ä½œç”¨å§

## è‡ªåŠ¨å¯¹è´¦ä¸»æµç¨‹

1. æ‹¿åˆ°å‰ä¸€å¤©çš„æ—¥æœŸ

```java
String reconDate = getReconciliationDate(date, org.getOrgCode());
```



2. ä»t_vcc_payorderè¡¨æŸ¥è¯¢æœ‰å‡ ç§ç¼´è´¹æ¸ é“

        ```java
payTypes = billService.queryPayChannelByDate(org.getOrgCode(), reconDate);
//è·å–ç¼´è´¹è®°å½•
SELECT 
	DISTINCT(pay_type),
	channel_id
FROM
	`t_vcc_payorder`
WHERE
	org_code = :orgCode
AND pay_update_time >= :startTime
AND pay_update_time <= :endTime
        ```

3. è·å–å¯¹è´¦å®ä½“ç±» æŸ¥è¯¢å½“å¤©æ˜¯å¦å¯¹è¿‡è´¦ï¼Œå¦‚æœå¯¹è¿‡è´¦åˆ™è·³è¿‡ï¼ˆè„šæœ¬æ˜¯è¿™æ ·ï¼‰

```java
pojo = getOrCreateReconciliation(org, reconDate, isTask, payTypes.get(i));
```





# 2020.09.16 ä¸šåŠ¡æºç æ•´ç†

## è‡ªåŠ¨å¯¹è´¦ä¸»æµç¨‹

> ä»Šå¤©ç»§ç»­æŸ¥çœ‹ä¸šåŠ¡

1. æ¯å¤©çš„æ¯ä¸ªæ¸ é“çš„å¯¹è´¦åˆ·æ–°éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œ
2. å¯¹è´¦è®°å½•çš„çŠ¶æ€

```java
/** åˆå§‹çŠ¶æ€ */
	int STATE_INIT = 0x00000100;                 256
	
	/** ä¸‹è½½è´¦å• */
	int STATE_DOWNLOAD_BILL = 0x00000101;        257
	
	/** æœ¬åœ°è´¦å•å…¥åº“*/
	int STATE_LOCAL_BILL = 0x00000103;           259
	
	/** æ‰å¸*/
	int STATE_CHECK_BILL = 0x00000107;           263
	
	/** æ¶ˆé™¤é”™è¯¯è´¦å• */
	int STATE_CLEAR_MISTAKE = 0x0000010f;        271
	
	/** å…¨éƒ¨ä½¿ç”¨ç¦åˆ©å¡çš„è®¢å•å…¥billè¡¨ */
	int FREECA_PAYORDER_2_BILL = 0x0000011d;     285
	
	/** ç”Ÿæˆå¯¹è´¦è´¦å•æ•°æ®*/
	int STATE_CREATE_BILL_FILE = 0x0000011f;     287
	
	/** é€šçŸ¥tcis */
	int STATE_NOTICE_TCIS = 0x0000013f;          319
	
	/** ç»“æŸ */
	int STATE_FINISH = 0x0000017f;               383
```

3. å¦‚æœæ²¡æœ‰å¯¹è¿‡è´¦ï¼Œé‚£ä¹ˆç”Ÿæˆä¸€æ¡è®°å½•ï¼Œå¹¶å»ºç«‹ä¸´æ—¶è¡¨ï¼Œå¦‚æœæœ¬èº«å°±æœ‰è®°å½•çš„è¯ï¼Œçœ‹çŠ¶æ€æ¥å®šæ˜¯ä¸æ˜¯è¦æ¸…ç©ºä¸´æ—¶è¡¨

```java
if (CommonUtil.isEmpty(pojoList)) {
				pojo.setVersion(1);
			} else {
				pojo.setVersion(pojoList.get(0).getVersion() + 1);
			}
			pojo.setReconDate(DateUtil.string2Date(reconDate));
			pojo.setStatus(BillContant.STATE_INIT);
			pojo.setOrgCode(org.getOrgCode());
			pojo.setPayChannelType(payType);
			billService.save(pojo);
			// å¦‚æœæ²¡æœ‰ä¸´æ—¶è¡¨ï¼Œå»ºä¸´æ—¶è¡¨
			billService.createLocalBillTemp("t_temp_local_bill_" + org.getOrgCode());
			billService.createRemoteBillTemp("t_temp_remote_bill_" + org.getOrgCode());
}
//æ¸…ç©ºä¸´æ—¶è¡¨ï¼Œå¯¹è´¦çŠ¶æ€æ˜¯259è¯´æ˜å¯¹è´¦handleræŠ¥é”™ï¼Œä¸éœ€è¦æ¸…ç©ºè¿œç¨‹å’Œæœ¬åœ°ä¸´æ—¶è¡¨ï¼Œ257è¯´æ˜æœ¬åœ°è´¦å•å…¥ä¸´æ—¶è¡¨æŠ¥é”™ï¼Œè¿œç¨‹è®¢å•å·²ç»å…¥ä¸´æ—¶è¡¨
		if(pojo.getStatus()<BillContant.STATE_LOCAL_BILL) {
			billService.truncateTable("t_temp_local_bill_" + org.getOrgCode());
		}
		if(pojo.getStatus()<BillContant.STATE_DOWNLOAD_BILL) {
			billService.truncateTable("t_temp_remote_bill_" + org.getOrgCode());
		}
```

4. å¾ªç¯æ¸ é“ï¼Œå¾ªç¯è„šæœ¬ï¼ŒæŸ¥çœ‹æ‰§è¡Œè¿‡çš„è®°å½•

```java
List<BillHandler> handlerList = getHandlerList();
```

5. æ ¹æ®çŠ¶æ€æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¦æ‰§è¡Œå½“å‰çš„è„šæœ¬

```java
// å½“å‰çš„çŠ¶æ€æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡
					if (pojo.getStatus() < handler.getState()) {
						boolean flag = handler.handle(pojo);
						if (flag) {
							pojo.setStatus(handler.getState());
							LoggerUtil.info("æ‰§è¡Œåçš„çŠ¶æ€pojo:{0}|{1}", pojo.getStatus(), handler.getState());
							pojo.setUpdateTime(DateUtil.getCurrentDate());
							// æ›´æ–°
							billService.updateEntity(pojo);
						} else {
							// è®°å½•æ—¥å¿— å½“å‰çŠ¶æ€åŠåç»­ä¸è¿›è¡Œå¤„ç†
							LoggerUtil.info("handler is end {0}|{1}|{2}", handler.getClass().getName(),
									org.getOrgCode(), pojo);
							break;
						}

					} else {
						// è®°å½•æ—¥å¿— å½“å‰çŠ¶æ€å·²å¤„ç†
						LoggerUtil.info("handler is already execute {0}|{1}|{2}", handler.getClass().getName(),
								org.getOrgCode(), pojo);
						continue;
					}
```

## å¯¹è´¦ç»†èŠ‚

1. ```java
   DownloadBillHandler
   ```

        - ä¸‹è½½ç›®æ ‡è·¯å¾„

```tex
#\u5546\u6237\u8BC1\u4E66\u5730\u5740
mch.certificate.path=/data/02/certificate/

#\u8D26\u5355\u4E0B\u8F7D\u5730\u5740
bill.download.path=/data/02/bill

#tcis\u8D26\u5355\u4FDD\u5B58\u5730\u5740
bill.file.path=/data/01

#tcis\u6587\u4EF6\u540C\u6B65\u5730\u5740
tcis.syncPath=/data/01/sync/
tcis3.0.syncPath=/data/01/
gas.transPath=/data/01/gasTransfer/
openapi.syncPath=/data/02/openApi/
```

1.1 å¾®ä¿¡æ”¯ä»˜

1.1.1 è·å–é…ç½®ä¿¡æ¯

```sql
select * from T_VCC_CONFIG_PARAM where group_code = 'PAY_WX' and param_code = 'APP_ID' and channel_id = 10010121//é…ç½®è¡¨

```

1.1.2 è·å–å¾®ä¿¡é‚£è¾¹çš„xmlä¿¡æ¯ï¼Œå¹¶è§£æï¼Œå†™åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹

```java
    String bill_type = "ALL";
		WxPayConfig config = new WxPayConfig();
		config.setAppId(appid);
		config.setMchId(spid);
		config.setNotifyUrl(CommonUtil.getRandomChar(16));
		config.setMchKey(mchKey);

		WxPayBillResult result = downloadBills(trans_time, bill_type, null, null, config, filePath, path, fileName);
```

1.1.3 æ’å…¥å¾®ä¿¡è¡¨

```java
StringBuffer buffer = new StringBuffer();
		buffer.append("insert into t_temp_remote_bill_");
		buffer.append(orgCode);
		buffer.append("(id,reconciliation_id,channel,pay_time,pay_trans_no,vcc_trans_no,pay_refund_no,vcc_refund_no,total_fee,pay_state,refund_fee,refund_state,pay_channel_type,mer_id)");
		buffer.append("values(?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
```

1.1.4 å°ç»“ï¼š

> ä¸»è¦çš„æ­¥éª¤å°±æ˜¯ æ‰¾åˆ°é…ç½®è¡¨ --> è¯·æ±‚å¾®ä¿¡è´¦å• --> ä¸‹è½½å¾®ä¿¡è´¦å• --> å†™å…¥ä¸´æ—¶è¡¨  



1.2 ç½‘ä»˜é€šå¯¹è´¦ å’Œ**å¾®ä¿¡æ”¯ä»˜**æ­¥éª¤åŸºæœ¬ä¸€è‡´

1.3 å¾·äº‘æ€å¯¹è´¦ å’Œ**å¾®ä¿¡æ”¯ä»˜**æ­¥éª¤åŸºæœ¬ä¸€è‡´

1.4 æ”¯ä»˜å®å¯¹è´¦ å’Œ**å¾®ä¿¡æ”¯ä»˜**åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯æ•°æ®ç»“æ„æ‰€æœ‰å˜åŒ–

```java
Collection<Object[]> objcts, int batchCount) throws ServiceException, SQLException {
		StringBuffer buffer = new StringBuffer();
		buffer.append("insert into t_temp_remote_bill_");
		buffer.append(orgCode);
		buffer.append("(id,reconciliation_id,channel,pay_time,pay_trans_no,vcc_trans_no,pay_refund_no,vcc_refund_no,total_fee, pay_state, refund_fee, refund_state, pay_channel_type, mer_id,subs_id,busi_type)");
		buffer.append("values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
		try {
			getGenericBaseDao().batchExecute(buffer.toString(), objcts, batchCount);
		}
		catch (DaoException e) {
			logger.info(e.getMessage());
			throw new ServiceException(e);
		}
```

1.5 æ”¯ä»˜å®ç”Ÿæ´» å’Œ**æ”¯ä»˜å®å¯¹è´¦**åŸºæœ¬ä¸€è‡´

1.6 æ”¯ä»˜å¹³å°å¯¹è´¦ æ„Ÿè§‰è¿™ä¸ªåœ°æ–¹æ²¡æœ‰ä¿å­˜æ–‡ä»¶ï¼Œå…¶ä»–çš„å’Œ**å¾®ä¿¡æ”¯ä»˜**æ­¥éª¤åŸºæœ¬ä¸€è‡´

> è‡ªæ­¤ï¼Œæ•´ä¸ªå¯¹è´¦çš„ç¬¬ä¸€æ­¥å®Œæˆ



2.LocalBillHandler

2.1  æœ¬åœ°è´¦å•å…¥åº“

2.1.1 æ’å…¥æ”¯ä»˜ä¿¡æ¯

```sql
INSERT INTO t_temp_local_bill_$orgCode(
	id,
	reconciliation_id,
	payorder_id,
	subs_id,
	busi_type,
	channel,
	pay_channel_type,
	vcc_trans_no,
	pay_trans_no,
	tcis_trans_no,
	total_fee,
	discount_fee,
	pay_state,
	pay_time,
	biz_state,
	biz_time,
	org_code
)
SELECT
	upper(MD5(UUID())) AS id,
	:reconciliationId as reconciliation_id,
	po.id AS payorder_id,
	po.subs_id AS subs_id,
	po.busi_type AS busi_type,
	po.pay_type AS channel,
	:payChannelType AS pay_channel_type,
	po.trade_no AS vcc_trans_no,
	po.transaction_id AS pay_trans_no,
	po.biz_sn AS tcis_trans_no,
	po.total_fee AS total_fee,
	(SELECT SUM(discount_fee) FROM `t_vcc_payorder_freeca` WHERE (payorder_id = po.id or parent_payorder_id = po.id)) AS discount_fee,
	'C' AS pay_state,
	po.pay_completed_time AS pay_time,
	po.biz_state AS biz_state,
	po.biz_update_time AS biz_time,
	po.org_code AS org_code
FROM
	t_vcc_payorder po
WHERE
	((po.biz_state in ('O', 'C', 'W', 'G') and po.parent_payorder_id is null)
			or (po.biz_state = 'L' and po.busi_type = 'G'))
	
#if($payChannelType == "weixin")
	and po.pay_type like '%weixin%' and po.pay_type not like '%gnetpg%' and po.channel_id not like '%DYS%' and po.channel_id not like '%openApi%'
#end

#if($payChannelType == "gnetpg")
	and po.pay_type like '%gnetpg%'
#end

#if($payChannelType == "alipay")
	and po.pay_type = 'alipay'
#end

#if($payChannelType == "alipay_lifepay")
	and po.pay_type = 'alipay_lifepay'
#end

#if($payChannelType == "DYS")
	and (po.channel_id like '%DYS%' or po.channel_id like '%openApi%')
#end

#if($payChannelType == "payment")
	and po.pay_type like '%payment%'
#end

AND po.org_code = :orgCode
AND po.pay_completed_time >= :timeBegin
AND po.pay_completed_time <= :timeEnd
```

2.1.2 æ’å…¥é€€æ¬¾ä¿¡æ¯

```sql
INSERT INTO t_temp_local_bill_$orgCode(
	id,
	reconciliation_id,
	payorder_id,
	subs_id,
	busi_type,
	channel,
	pay_channel_type,
	vcc_trans_no,
	pay_trans_no,
	tcis_trans_no,
	vcc_refund_no,
	pay_refund_no,
	total_fee,
	discount_fee,
	pay_state,
	pay_time,
	biz_state,
	biz_time,
	org_code
)
SELECT
	upper(MD5(UUID())) AS id,
	:reconciliationId as reconciliation_id,
	po.id AS payorder_id,
	po.subs_id AS subs_id,
	po.busi_type AS busi_type,
	po.pay_type AS channel,
	:payChannelType AS pay_channel_type,
	po.trade_no AS vcc_trans_no,
	po.transaction_id AS pay_trans_no,
	po.biz_sn AS tcis_trans_no,
	po.out_refund_no AS vcc_refund_no,
	po.refund_no AS pay_refund_no,
	po.total_fee AS total_fee,
	(SELECT SUM(discount_fee) FROM `t_vcc_payorder_freeca` WHERE (payorder_id = po.id or parent_payorder_id = po.id)) AS discount_fee,
	po.pay_state AS pay_state,
	po.pay_update_time AS pay_time,
	po.biz_state AS biz_state,
	po.biz_update_time AS biz_time,
	po.org_code AS org_code
FROM
	t_vcc_payorder po
WHERE
	po.pay_state IN ('B','F')
AND po.busi_type != 'G'

#if($payChannelType == "weixin")
	 and po.pay_type like '%weixin%' and po.pay_type not like '%gnetpg%' and po.channel_id not like '%DYS%' and po.channel_id not like '%openApi%'
#end

#if($payChannelType == "gnetpg")
	and po.pay_type like '%gnetpg%'
#end

#if($payChannelType == "alipay")
	and po.pay_type = 'alipay'
#end

#if($payChannelType == "DYS")
	and (po.channel_id like '%DYS%' or po.channel_id like '%openApi%')
#end

#if($payChannelType == "payment")
	and po.pay_type like '%payment%'
#end

AND po.org_code = :orgCode
AND po.pay_update_time >= :timeBegin
AND po.pay_update_time <= :timeEnd
```

> å°ç»“ï¼šè¿™ä¸ªç±»å°±æ˜¯2ä¸ªsqlï¼Œå°†æœ¬åœ°çš„æ•°æ®åŠ å…¥è¦å¯¹æ¯”ä¸´æ—¶è¡¨ä¹‹ä¸­

3. ReconciliatonCheckHandler

> è¿™ä¸ªæˆ–è®¸æ˜¯çœŸæ­£çš„æ ¸å¿ƒé€»è¾‘

3.1.1 æ‹¿åˆ°è¿œç¨‹æ•°æ®å’Œæœ¬åœ°æ•°æ®

```sql
select 
id,
reconciliation_id,
payorder_id,
subs_id,
busi_type,
channel,
vcc_trans_no,
pay_trans_no,
tcis_trans_no,
vcc_refund_no,
pay_refund_no,
tcis_refund_no,
total_fee,
discount_fee,
pay_state,
pay_time,
biz_state,
biz_time,
org_code

 from t_temp_local_bill_$orgCode 
where reconciliation_id = :conId
#if($payState)
and pay_state = :payState
#end
```

```sql
select 
id,
reconciliation_id,
channel,
pay_channel_type,
pay_time,
pay_trans_no,
vcc_trans_no,
pay_refund_no,
vcc_refund_no,
total_fee,
pay_state,
refund_fee,
mer_id,
subs_id,
busi_type
from t_temp_remote_bill_$orgCode 
where channel = :orgCode 
and reconciliation_id = :reconciliationId
and pay_channel_type = :payChannelType

```

3.1.2 å¾ªç¯å¯¹æ¯”2å¼ è¡¨çš„ä¿¡æ¯

```java
for (RemoteBillPojo remoteBill : remoteBills) {
				Boolean flag = false;// ç”¨äºæ ‡è®°æ˜¯å¦æœ‰åŒ¹é…
				
				for (LocalBillPojo localbill : localBills) {
   					//...       
        }
}
```

ä¸¤è€…çš„å…³ç³»ä¸»è¦å»ºç«‹äº***PayTransNo***

3.1.2.1æƒ…å†µåˆ¤æ–­

```java
if (localbill.getPayTransNo().equalsIgnoreCase(remoteBill.getPayTransNo()))
```

3.1.2.2åˆ¤æ–­çŠ¶æ€ä¸º***å®Œæˆæ”¯ä»˜*** ä¸” ***é‡‘é¢ç›¸ç­‰***

```java
if (PayorderPojo.PAYSTATE_PAIDED.equals(localbill.getPayState()) 
									&& localbill.getRealPayFee() != null && remoteBill.getTotalFee() != null
									&& localbill.getRealPayFee().compareTo(remoteBill.getTotalFee()) == 0)
```

3.1.2.3 å¦‚æœæ˜¯åˆå¹¶ç¼´è´¹åˆ™æ·»åŠ æ‰€æœ‰çš„å­å•è¿›å…¥è¿”å›ç±»ï¼Œå¦‚æœä¸æ˜¯ï¼Œåªè¦æ·»åŠ ä¸€ä¸ªä¸»å•å³å¯

```java
if (BusiCodeDef.PAY_MERGE_FEE.equals(localbill.getBusiType())) {
									childPayorderNum = addChildPayOrderToBill(localbill.getPayorderId(), pojo, billList, true,
											BillContant.RECONCILIATION_STATE_CONFIRM, BillContant.FLAG_IS_NOT_MANUAL,
											"åˆå¹¶ç¼´è´¹", null, null, remoteBill.getPayTime(), PayorderPojo.PAYSTATE_PAIDED,
											remoteBill.getMerId(), localbill.getDiscountFee());
								} else {
									LoggerUtil.info("åŒ¹é…è´¦å•é‡‘é¢æ˜¯å¦ç›¸ç­‰[{0}]", localbill.getId());
									BillPojo billPojo =  createBillPojo(null, pojo, localbill, true, merId);
									billPojo.setManualFlag(BillContant.FLAG_IS_NOT_MANUAL);
									//å¯¹è´¦æˆåŠŸ
									billPojo.setPayReconciliationState(BillContant.RECONCILIATION_STATE_CONFIRM);
									billPojo.setParentVccTransNo(localbill.getVccTransNo());
									billPojo.setMerId(remoteBill.getMerId());
									billList.add(billPojo);
								}
```

3.1.2.4 å¢åŠ ç»Ÿè®¡æ•°æ®

```java
// vccæ”¯ä»˜å•é‡å’Œè´¹ç”¨ç»Ÿè®¡
								vccPayOrderNum = vccPayOrderNum + childPayorderNum;
								vccPayTotalFee = vccPayTotalFee + localbill.getRealPayFee();
								if (localbill.getDiscountFee() != null && localbill.getDiscountFee() > 0) {
									freecaTotalFee += localbill.getDiscountFee();
									freecaOrderNum ++;
								}
								break;
```

3.1.3.1æƒ…å†µåˆ¤æ–­

é‡‘é¢ä¸åŒ¹é…å…¶ä»–åŒ¹é…

```java
if ((PayorderPojo.PAYSTATE_PAIDED.equals(localbill.getPayState())) 
      && localbill.getRealPayFee() != null && remoteBill.getTotalFee() != null
      && localbill.getRealPayFee().compareTo(remoteBill.getTotalFee()) != 0)
```





# 2020.09.17å…³äºesçš„å¯è§†åŒ–å·¥å…·

> ä»Šå¤©ç»§ç»­å•ƒå¯¹è´¦ä¸šåŠ¡æºç 

> å•ƒåˆ°ä¸€åŠé¢†å¯¼å®‰æ’äº†æˆ‘å»å¯»æ‰¾å¯ä»¥åª²ç¾phpadminçš„esæ“ä½œå·¥å…·

1. å¯åŠ¨esï¼Œæ²¡æœ‰å•¥å¯è¯´

![image-20200918143640470](/Users/juzelong/Documents/image-20200918143640470.png)

2. head

![image-20200918143734670](/Users/juzelong/Documents/image-20200918143734670.png)

> è¿™ä¸ªå·¥å…·ç®—æ˜¯ä¸Šå¤æ—¶æœŸçš„uiä½œå“ï¼Œä»–åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™ç›¸å¯¹æ¯”è¾ƒæ–¹ä¾¿ï¼Œå…¶ä»–çš„æ²¡æœ‰å¤ªå¤šå‡ºå½©çš„åœ°æ–¹ï¼Œå¼€ç®±å³ç”¨ã€‚

![image-20200918143952776](/Users/juzelong/Documents/image-20200918143952776.png)

3. Kibana

> è¿™ä¸ªå·¥å…·å¯ä»¥è¯´æ˜¯å®˜æ–¹çš„æ ‡å‡†å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¾ˆå¤šçš„ä¸œè¥¿æœ‰æç¤ºå’Œæ’ä»¶ï¼Œå‰©ä¸‹çš„éœ€è¦è‡ªå·±é’»ç ”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¾¾åˆ°å°ç™½éƒ½å¯ä»¥æ“ä½œçš„åœ°æ­¥
>
> æˆ‘çš„ç»“è®ºæ˜¯å¼€å‘äººå‘˜ä½¿ç”¨å®ƒæ—¶éå¸¸åˆé€‚çš„ï¼Œä»–å®Œå…¨å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸»è¦çš„esæŸ¥è¯¢å·¥å…·ã€‚

![image-20200918144243901](/Users/juzelong/Documents/image-20200918144243901.png)

4. Dejavu

> è¿™ä¸ªå·¥å…·å¯¹äºå°ç™½è€Œè¨€ç®€ç›´å®Œç¾ï¼Œåº”è¯¥å¯ä»¥èƒœä»»é¢†å¯¼çš„è¦æ±‚

![image-20200918150721379](/Users/juzelong/Documents/image-20200918150721379.png)

5. ElasticHD

> è¿™ä¸ªå·¥å…·çš„é¦–é¡µå¤§ç›˜å¯è°“æƒŠè‰³ï¼Œå¯ä»¥åšä¸ºä¿¯ç°æ•´ä¸ªé›†ç¾¤çŠ¶æ€çš„ä¸»è¦æ‰‹æ®µ

![image-20200918151541624](/Users/juzelong/Documents/image-20200918151541624.png)



# 2020.09.21 mybatisçš„ç§˜å¯†

> ä»Šå¤©è¦ä¹ˆç»§ç»­çœ‹å¯¹è´¦æºç ï¼Œè¦ä¹ˆçœ‹springï¼Œ2é€‰ä¸€ï¼Œå…¶å®æˆ‘æ›´å€¾å‘äºåè€…ï¼Œæ¯•ç«Ÿå‰è€…ç­‰äººå›æ¥å†çœ‹æˆ–è®¸äº‹åŠåŠŸå€ï¼Œä½†æ˜¯æˆ‘çš„è€³æœºç­”ä¸ç­”åº”æ˜¯ä¸ªé—®é¢˜ã€‚

>  ç»è¿‡1ä¸ªå¤šå°æ—¶çš„æ€æƒ³æ–—äº‰ï¼Œæœ€ç»ˆé é‡å¯ç”µè„‘è§£å†³äº†è€³æœºè¿æ¥çš„é—®é¢˜ï¼Œé‚£æˆ‘ç»§ç»­æˆ‘çš„spring+mybatisä¹‹æ—…å§

## mybatisçš„é…ç½®ä¸helloworld

1. æ–°å»ºmavené¡¹ç›®å¹¶é…ç½®mavençš„ä¸‰ä¸ªåœ°å€

![image-20200921113757421](/Users/juzelong/Documents/image-20200921113757421.png)

2.  åˆ é™¤srcå¹¶å†™å…¥ä¾èµ–

![image-20200921114427444](/Users/juzelong/Documents/image-20200921114427444.png)

3. åˆ›å»ºæ–°æ¨¡å—åï¼Œå­é¡¹ç›®å°±å¯ä»¥æ‹¥æœ‰æ‰€æœ‰çš„ä¾èµ–åŒ…

![image-20200921115545026](/Users/juzelong/Documents/image-20200921115545026.png)

4. é…ç½®mybatis xml

![image-20200921134536331](/Users/juzelong/Documents/image-20200921134536331.png)

5. ç¼–å†™mybatiså·¥å…·ç±»

![image-20200921135811598](/Users/juzelong/Documents/image-20200921135811598.png)

6. ç¼–å†™pojoå®ä½“ç±»ï¼ŒuserDaoæ¥å£ï¼Œxmlæ–‡ä»¶

   ![image-20200921145753745](/Users/juzelong/Documents/image-20200921145753745.png)

```java
package com.ju.pojo;

public class User {
    private int id;
    private String name;
    private String pwd;

    public User() {
    }

    public User(int id, String name, String pwd) {
        this.id = id;
        this.name = name;
        this.pwd = pwd;
    }

    public int getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    public String getPwd() {
        return pwd;
    }

    public void setId(int id) {
        this.id = id;
    }

    public void setName(String name) {
        this.name = name;
    }

    public void setPwd(String pwd) {
        this.pwd = pwd;
    }
}
```

```java
package com.ju.dao;

import com.ju.pojo.User;

import java.util.List;

public interface UserDao {
    List<User> getUserList();
}

```

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ju.dao.UserDao">

<select id="getUserList" resultType="com.ju.pojo.User">
    select * from mybatis.user;
</select>

</mapper>
```

7.  ç¼–å†™æµ‹è¯•ç”¨ä¾‹

```java
package com.ju.dao;

import com.ju.pojo.User;
import com.ju.utils.MybatisUtils;
import org.apache.ibatis.session.SqlSession;
import org.junit.Test;

import java.util.List;

public class UserDaoTest {
    @Test
    public void test() {
        SqlSession sqlSession = MybatisUtils.getSqlSession();
        UserDao mapper = sqlSession.getMapper(UserDao.class);
        List<User> userList = mapper.getUserList();

        for (User user : userList) {
            System.out.println(user.getName());
        }

        sqlSession.close();

    }
}

```

8. å…³äºè¿™ä¸ªhelloworldçš„ä¸€äº›å‘

   - mapperçš„xmléƒ½å¿…é¡»å†™åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­

   ![image-20200921150037187](/Users/juzelong/Documents/image-20200921150037187.png)

   - é“¾æ¥çš„å®‰å…¨æ€§å¼€å…³ï¼Œå¼€å¯ç›®å‰æ˜¯ä¼šæŠ¥é”™çš„![image-20200921150137645](/Users/juzelong/Documents/image-20200921150137645.png)

   - å¦‚æœä¸åŠ å…¥é…ç½®æ–‡ä»¶çš„è¯ï¼Œå¾ˆå¤šä¸œè¥¿ä¼šè¿‡æ»¤è€Œä¸åŠ è½½

   ```java
        <build>
            <resources>
                <resource>
                    <directory>src/main/resources</directory>
                    <includes>
                        <include>**/*.properties</include>
                        <include>**/*.xml</include>
                    </includes>
                    <filtering>true</filtering>
                </resource>
                <resource>
                    <directory>src/main/java</directory>
                    <includes>
                        <include>**/*.properties</include>
                        <include>**/*.xml</include>
                    </includes>
                    <filtering>true</filtering>
                </resource>
            </resources>
        </build>
   
   ```

   - mysql8.0éœ€è¦æ–°çš„åŒ…å’Œé©±åŠ¨

     ```java
     <dependency>
                 <groupId>mysql</groupId>
                 <artifactId>mysql-connector-java</artifactId>
                 <version>8.0.11</version>
             </dependency>
     ```

â€‹          ![image-20200921150519237](/Users/juzelong/Documents/image-20200921150519237.png)

## mybatis CURD

1. å•ä¸ªå‚æ•°å•ä¸ªè®°å½•

```xml
<select id="getUserById" parameterType="int" resultType="com.ju.pojo.User">
        select * from mybatis.user where id = #{id};
    </select>
```

```java
User getUserById(int id)
```

2. å¢åŠ 

```xml
<insert id="addUser" parameterType="com.ju.pojo.User">
        insert into user value(#{id}, #{name}, #{pwd})
    </insert>
```

```java
User getUserById(int id);
```

3. æ”¹

```java
<update id="updateUser" parameterType="com.ju.pojo.User" >
        update mybatis.user set name = #{name}, pwd = #{pwd} where id = #{id} ;
    </update>
```

```java
int updateUser(User user);
```

4. åˆ 

```java
<delete id="deleteUser" parameterType="int" >
        delete from mybatis.user where id = #{id} ;
    </delete>
```

```java
int deleteUser(int id);
```



## mybatis é…ç½®

1. å±æ€§é…ç½® 

![image-20200921165134778](/Users/juzelong/Documents/image-20200921165134778.png)

2. å¼•å…¥å±æ€§

![image-20200921165600838](/Users/juzelong/Documents/image-20200921165600838.png)

3. åˆ«å

![image-20200921170959301](/Users/juzelong/Documents/image-20200921170959301.png)

![image-20200921171011765](/Users/juzelong/Documents/image-20200921171011765.png)

**æ¨èä½¿ç”¨æ‰«æåŒ…çš„å½¢å¼**

![image-20200921171315467](/Users/juzelong/Documents/image-20200921171315467.png)

4. æ˜ å°„å™¨çš„ä¸‰ç§æ–¹å¼

![image-20200921174544760](/Users/juzelong/Documents/image-20200921174544760.png)

# 2020.9.22 å¯¹è´¦ä¸šåŠ¡æ ¡éªŒsql

> ä»Šå¤©å¦‚æœæ²¡æœ‰æ–°çš„ä»»åŠ¡ï¼Œç»§ç»­å­¦mybatis

## mybatis å±æ€§åå­—æ®µåä¸ä¸€è‡´

![image-20200922100232349](/Users/juzelong/Documents/image-20200922100232349.png)

## æ—¥å¿—å·¥å‚

1. æ ‡å‡†é…ç½®

```java
<settings>
        <setting name="logImpl" value="STDOUT_LOGGING"/>
    </settings>
```



## log4j

1. å¯¼å…¥ä¾èµ–

```java
<dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.17</version>
        </dependency>
```

2. æ–°å»ºé…ç½®

![image-20200922105839642](/Users/juzelong/Documents/image-20200922105839642.png)

```java
#############
# è¾“å‡ºåˆ°æ§åˆ¶å°
#############

# log4j.rootLoggeræ—¥å¿—è¾“å‡ºç±»åˆ«å’Œçº§åˆ«ï¼šåªè¾“å‡ºä¸ä½äºè¯¥çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯DEBUG < INFO < WARN < ERROR < FATAL
# WARNï¼šæ—¥å¿—çº§åˆ«     CONSOLEï¼šè¾“å‡ºä½ç½®è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªåå­—       logfileï¼šè¾“å‡ºä½ç½®è‡ªå·±å®šä¹‰çš„ä¸€ä¸ªåå­—
log4j.rootLogger=DEBUG,CONSOLE,logfile
# é…ç½®CONSOLEè¾“å‡ºåˆ°æ§åˆ¶å°
log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender 
# é…ç½®CONSOLEè®¾ç½®ä¸ºè‡ªå®šä¹‰å¸ƒå±€æ¨¡å¼
log4j.appender.CONSOLE.Target=System.out
log4j.appender.CONSOLE.Threshold=DEBUG
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout 
# é…ç½®CONSOLEæ—¥å¿—çš„è¾“å‡ºæ ¼å¼  [frame] 2019-08-22 22:52:12,000  %rè€—è´¹æ¯«ç§’æ•° %pæ—¥å¿—çš„ä¼˜å…ˆçº§ %tçº¿ç¨‹å %Cæ‰€å±ç±»åé€šå¸¸ä¸ºå…¨ç±»å %Lä»£ç ä¸­çš„è¡Œå· %xçº¿ç¨‹ç›¸å…³è”çš„NDC %mæ—¥å¿— %næ¢è¡Œ
log4j.appender.CONSOLE.layout.ConversionPattern=[frame] %d{yyyy-MM-dd HH:mm:ss,SSS} - %-4r %-5p [%t] %C:%L %x - %m%n

################
# è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­
################

# é…ç½®logfileè¾“å‡ºåˆ°æ–‡ä»¶ä¸­ æ–‡ä»¶å¤§å°åˆ°è¾¾æŒ‡å®šå°ºå¯¸çš„æ—¶å€™äº§ç”Ÿæ–°çš„æ—¥å¿—æ–‡ä»¶
log4j.appender.logfile=org.apache.log4j.RollingFileAppender
# ä¿å­˜ç¼–ç æ ¼å¼
log4j.appender.logfile.Encoding=UTF-8
# è¾“å‡ºæ–‡ä»¶ä½ç½®æ­¤ä¸ºé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„logsæ–‡ä»¶å¤¹ä¸­
log4j.appender.logfile.File=logs/root.log
# åç¼€å¯ä»¥æ˜¯KB,MB,GBè¾¾åˆ°è¯¥å¤§å°ååˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶
log4j.appender.logfile.MaxFileSize=10MB
# è®¾ç½®æ»šå®šæ–‡ä»¶çš„æœ€å¤§å€¼3 æŒ‡å¯ä»¥äº§ç”Ÿroot.log.1ã€root.log.2ã€root.log.3å’Œroot.logå››ä¸ªæ—¥å¿—æ–‡ä»¶
log4j.appender.logfile.MaxBackupIndex=3  
# é…ç½®logfileä¸ºè‡ªå®šä¹‰å¸ƒå±€æ¨¡å¼
log4j.appender.logfile.layout=org.apache.log4j.PatternLayout
log4j.appender.logfile.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %F %p %m%n

##########################
# å¯¹ä¸åŒçš„ç±»è¾“å‡ºä¸åŒçš„æ—¥å¿—æ–‡ä»¶
##########################

log4j.appender.console=org.apache.log4j.ConsoleAppender

log4j.logger.org.mybatis=DEBUG
log4j.logger.java.sql=DEBUG
log4j.logger.java.sql.Statement=DEBUG
log4j.logger.java.sql.ResultSet=DEBUG
log4j.logger.java.sql.PreparedStatement=DEBUG
```

3. ç®€å•ä½¿ç”¨

```java
import org.apache.log4j.Logger;
import org.junit.Test;

import java.util.List;

public class UserMapperTest {

    static Logger logger = Logger.getLogger(UserMapperTest.class);

    @Test
    public void testLog4j() {
        logger.info("info è¿›å…¥äº†");
        logger.debug("debug è¿›å…¥äº†");
        logger.error("error è¿›å…¥äº†");
    }
}
```

## ç®€å•åˆ†é¡µ

```java
List<User> getUserListByLimit(Map<String, Integer> map);
```

```java
<resultMap id="UseMap2" type="User">
        <result column="id" property="id" />
        <result column="name" property="name" />
        <result column="pwd" property="password" />
    </resultMap>
    <select id="getUserListByLimit" parameterType="map" resultMap="UseMap2">
        select * from mybatis.user limit #{startIndex}, #{pageSize}
    </select>
```

```java
 @Test
    public void testLimit() {
        SqlSession sqlSession = MybatisUtils.getSqlSession();
        UserMapper mapper = sqlSession.getMapper(UserMapper.class);

        HashMap<String, Integer> stringIntegerHashMap = new HashMap<String, Integer>();
        stringIntegerHashMap.put("startIndex", 0);
        stringIntegerHashMap.put("pageSize", 2);
        List<User> userList = mapper.getUserListByLimit(stringIntegerHashMap);

        for (User user : userList) {
            System.out.println(user);
        }

        sqlSession.close();

    }
```

## å…³äºå¯¹è´¦çš„ä¸šåŠ¡

> å¼€å§‹

1. ç¼´è´¹å¹³å° -> vcc -> tcis

tcisç”Ÿæˆç¼´è´¹->vcc-> ç¼´è´¹

æŸ¥è¯¢ä¸šåŠ¡çš„sql

```sql
select p.pay_completed_time ç¼´è´¹æ—¶é—´,s.code æˆ·å·,p.total_fee ç¼´è´¹é‡‘é¢,p.trade_no VCCæµæ°´å·,p.busi_type
from t_vcc_payorder p
left join t_vcc_subs s on s.id=p.subs_id
where p.pay_completed_time >='2019-05-08 00:00:00' and p.pay_completed_time <'2019-06-01 00:00:00' 
and p.pay_type='alipay_lifepay' and p.org_code='YH0105' and p.pay_state in ('C') and p.id not in(
 select payorder_id from t_vcc_bill where reconciliation_id in
  (select id from t_vcc_reconciliation where pay_channel_type='alipay_lifepay' 
  and org_code='YH0105' and recon_date between '2019-05-08' and '2019-05-31'))
order by p.pay_completed_time
```



# 2020.9.23 mybatiså®Œç»“

> ä»æ˜¨å¤©çš„å¯¹è´¦ä¸šåŠ¡æ¥çœ‹ï¼Œä¸»è¦çš„æ˜¯æ ¹æ®sqlæŸ¥å‡ºä¸å¯¹çš„åœ°æ–¹ï¼Œç„¶åæŠŠä¸å¯¹çš„åœ°æ–¹å‘é€ç»™è¿è¥å³å¯ï¼Œä»£ç å±‚é¢çš„æ”¹é©ç›®å‰æœ‰é˜»åŠ›ï¼Œé¡¹ç›®æœ¬åœ°è·‘ä¸èµ·æ¥ï¼Œæš‚æ—¶å…ˆæŠŠmybatisçœ‹å®Œ

## Lombokæ’ä»¶

1. å¯¼å…¥ä¾èµ–

```java
<dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.12</version>
            <scope>provided</scope>
        </dependency>
```

2. å®‰è£…ideaæ’ä»¶
3. å¯ä½¿ç”¨çš„æ³¨è§£

```javascript
@Getter and @Setter
@FieldNameConstants
@ToString
@EqualsAndHashCode
@AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructor
@Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog
@Data
@Builder
@SuperBuilder
@Singular
@Delegate
@Value
@Accessors
@Wither
@With
@SneakyThrows
@val
@var
experimental @var
@UtilityClass
Lombok config system
```

4. å¼€å§‹ä½¿ç”¨

```java
package com.ju.pojo;

import lombok.*;

@Data                 // get set å‡ ä¹æ‰€æœ‰çš„ä¸œè¥¿
@AllArgsConstructor   // æœ‰å‚æ„é€ å™¨
@NoArgsConstructor    // æ— å‚æ„é€ å™¨
@EqualsAndHashCode    // equalså’Œhashcode
@ToString             // toString
public class User {
    private int id;
    private String name;
    private String password;
}

```

## å¤šå¯¹ä¸€çš„ä¸¤ç§æ–¹å¼

1. æ ¹æ®ç»“æœæ˜ å°„

Xml:

```xml
<select id="getStudentList" resultMap="StudentTeacher">
    select * from mybatis.student;
</select>
    <resultMap id="StudentTeacher" type="Student">
        <result property="id" column="id" />
        <result property="name" column="name" />
        <association property="teacher" column="teacher_id" javaType="Teacher" select="getTeacher" />
    </resultMap>

    <select id="getTeacher" resultType="Teacher">
        select * from teacher where id = #{id}
    </select>
```

2. æ ¹æ®å­—æ®µè‡ªå·±å»æŸ¥è¯¢

Xml:

```xml
<select id="getStudentListWithTeacherName" resultMap="studentTeacherName">
    select s.id as student_id,s.name as student_name, t.name as teacher_name
       from student s left join teacher t
on t.id = s.teacher_id
</select>

    <resultMap id="studentTeacherName" type="Student">
        <result property="id" column="student_id"/>
        <result property="name" column="student_name"/>
        <association property="teacher" javaType="Teacher">
            <result property="name" column="teacher_name"/>
        </association>
    </resultMap>
```

Mapper:

```java
List<Student> getStudentList();
```

Pojo:

```java
package com.ju.pojo;

import lombok.Data;

@Data      // get set
public class Student {
    private int id;
    private String name;

    private Teacher teacher;
}
```

## ä¸€å¯¹å¤š

Xml:

```xml

<select id="getTeacher" resultMap="teacherStudent">
   select t.id as tid, t.name as tname, s.id as sid, s.name as sname, s.teacher_id from teacher t left join student s
on s.teacher_id = t.id where t.id = #{id}
</select>

    <resultMap id="teacherStudent" type="Teacher">
        <result property="name" column="tname"/>
        <result property="id" column="tid" />
        <collection property="students" ofType="Student">
            <result property="name" column="sname"/>
            <result property="id" column="sid"/>
            <result property="teacherId" column="teacher_id"/>
        </collection>
    </resultMap>
```

Mapper:

```java
@Test
    public void testGetTeacher() {
        SqlSession sqlSession = MybatisUtils.getSqlSession();
        TeacherMapper mapper = sqlSession.getMapper(TeacherMapper.class);

        Teacher teacher1 = mapper.getTeacher(1);

        System.out.println(teacher1);


        sqlSession.close();
    }
```

Pojo:

```java
@Data      // get set
public class Teacher {
    private int id;
    private String name;
    private List<Student> students;
}
```

```java
@Data      // get set
public class Student {
    private int id;
    private String name;
    private int teacherId;
}
```

## åŠ¨æ€sql

å·ä¸ªæ‡’ https://mybatis.org/mybatis-3/zh/dynamic-sql.htm

ç»å¤§å¤šæ•°æ ‡ç­¾å®˜ç½‘æœ‰æåˆ° ä½†æ˜¯sqlç‰‡æ®µæ²¡æœ‰ï¼Œæ”¾åœ¨è¿™é‡Œ

```xml
    <sql id="studentT">
        select s.id as student_id,s.name as student_name, t.name as teacher_name
       from student s left join teacher t
on t.id = s.teacher_id
    </sql>

<select id="getStudentListWithTeacherName" resultMap="studentTeacherName">
    <include refid="studentT"/>
</select>
```

## ç¼“å­˜ç›¸å…³

1. ä¸€çº§ç¼“å­˜æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€æœ‰çš„ç¼“å­˜éƒ½åªæ˜¯é’ˆå¯¹ä¸€ä¸ªmapper.xml
2. äºŒçº§ç¼“å­˜å¼€å¯ 

```xml
<!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
    <cache
            eviction="FIFO"
            flushInterval="60000"
            size="512"
            readOnly="true"/>

    <select id="getUserById" parameterType="int" resultMap="UseMap" useCache="true">
        select * from mybatis.user where id = #{id};
    </select>
```

```java
@Test
    public void testGetId() {
        SqlSession sqlSession = MybatisUtils.getSqlSession();
        UserMapper mapper = sqlSession.getMapper(UserMapper.class);
        User userById = mapper.getUserById(1);
        System.out.println(userById);
        sqlSession.close();

        SqlSession sqlSession2 = MybatisUtils.getSqlSession();
        UserMapper mapper2 = sqlSession2.getMapper(UserMapper.class);
        User userById2 = mapper2.getUserById(1);
        System.out.println(userById2);
        sqlSession2.close();
    }
```

> è¯´ä¸å¥½å¬ç‚¹ï¼Œéƒ½æ˜¯é¸¡è‚‹ï¼Œç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨**sqlSession**çš„å¼€å¯å’Œç»“æŸä¹‹ä¸­ï¼Œå¤ªçŸ­äº†ã€‚
>
> å®Œç»“ï¼Œæ’’èŠ±ğŸ‰
>
> å¦‚æœæ²¡æœ‰æ–°ä»»åŠ¡ï¼Œé‚£æˆ‘å°±ç»§ç»­æˆ‘çš„springä¹‹æ—…

# 2020.9.24 hello spring

> æš‚æ—¶å†çœ‹ä¸‹springå§ï¼Œæ²¡æƒ³åˆ°springçš„åˆ›å§‹äººæ˜¯ä¸ªéŸ³ä¹æ•™æˆã€‚

> springçš„æ‰€æœ‰å†å²ç‰ˆæœ¬ https://repo.spring.io/release/org/springframework/spring/
>
> githubåœ°å€ https://github.com/spring-projects/spring-framework/tree/5.2.x

1. å¼•å…¥ä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-webmvc</artifactId>
    <version>5.2.9.RELEASE</version>
</dependency>
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.2.9.RELEASE</version>
</dependency>
```

2. ![image-20200924141810629](/Users/juzelong/Documents/image-20200924141810629.png)
3. hello spring!

![image-20200925093258492](/Users/juzelong/Documents/image-20200925093258492.png)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">
    <!-- ä½¿ç”¨springæ¥åˆ›å»ºå¯¹è±¡ -->
    <bean id="hello" class="com.ju.pojo.Hello" >
        <property name="str" value="Spring" />
    </bean>


</beans>
```

![image-20200925093333811](/Users/juzelong/Documents/image-20200925093333811.png)

```java
import com.ju.pojo.Hello;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class myTest {
    public static void main(String[] args) {
        //è·å–springçš„ä¸Šä¸‹æ–‡å¯¹è±¡
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        Hello hello = (Hello) context.getBean("hello");
        String str = hello.getStr();
        System.out.println(str);
    }
}
```

# 2020.9.25 nginx

> ç¨å¾®æ‰“æ–­ä¸€ä¸‹ï¼Œä»Šå¤©çœ‹ä¸‹åŸºç¡€çŸ¥è¯†

## nginx

> æˆ‘æœ¬åœ°çš„nginxæ–‡ä»¶è·¯å¾„  /usr/local/Cellar/nginx/1.17.3_1/bin
>
> â€‹                                  /usr/local/etc/nginx

![image-20200925100507201](/Users/juzelong/Documents/image-20200925100507201.png)

1. è´Ÿè½½å‡è¡¡

![](/Users/juzelong/Documents/image-20200925141051714.png)
1.1æƒé‡è´Ÿè½½å‡è¡¡:

![image-20200925141015216](/Users/juzelong/Documents/image-20200925141015216.png)

1.2 ip_hashæ¨¡å¼ï¼ˆæ‹¿ipå–æ¨¡å³å¯ï¼Œä½†æ˜¯è¿æ°”ä¸å¥½å¯èƒ½é€ æˆå–çš„æ¨¡ä¸€ç›´ä¸€æ ·ï¼Œé€ æˆå€¾æ–œï¼‰

![image-20200925141318686](/Users/juzelong/Documents/image-20200925141318686.png)

2. backupå…³é”®å­— ä¸»è¦æ˜¯æ‰€æœ‰ç›¸å…³æœåŠ¡å™¨å®•æœºä»¥åï¼Œå¯åŠ¨è®¿é—®ï¼Œæœ€å¤§çš„ä½œç”¨æ˜¯åœ¨æ›´æ–°ä¸Šä»£ç çš„æ—¶å€™å¤„ç†æ‰å¤šæœåŠ¡å™¨è®¿é—®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

![image-20200925142319826](/Users/juzelong/Documents/image-20200925142319826.png)

3. é™æ€ä»£ç†

![image-20200925144532330](/Users/juzelong/Documents/image-20200925144532330.png)

# 2020.9.27 ä¸€äº›åŸºç¡€çŸ¥è¯†çš„æ•´ç†

## å•ä¾‹æ¨¡å¼ä¸­çš„å„ç§å®ç°æ¨¡å¼

```java

//é¥¿æ±‰æ¨¡å¼ï¼Œå¾ˆé¥¿å¾ˆç€æ€¥ï¼Œæ‰€ä»¥ç±»åŠ è½½æ—¶å³åˆ›å»ºå®ä¾‹å¯¹è±¡
public class Singleton1 {
	
	private static Singleton1 singleton = new Singleton1();
	
	private Singleton1(){
		
	}
	
	public static Singleton1 getInstance(){
		return singleton;
	}
}
```

```java

//é¥±æ±‰æ¨¡å¼ï¼Œå¾ˆé¥±ä¸ç€æ€¥ï¼Œå»¶è¿ŸåŠ è½½ï¼Œå•¥æ—¶å€™ç”¨å•¥æ—¶å€™åˆ›å»ºå®ä¾‹ï¼Œå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜
public class Singleton2 {
 
	private static Singleton2 singleton;
	
	private Singleton2(){
		
	}
	
	public static synchronized Singleton2 getInstance(){
		if(singleton == null) 
			singleton = new Singleton2();
		return singleton;
	}
}

```

```java

//é¥±æ±‰æ¨¡å¼çš„åŒé‡é”æ¨¡å¼ï¼Œæé«˜æ•ˆç‡
public class Singleton3 {
	private static Singleton3 singleton;
	
	private Singleton3(){
		
	}
	
	public static Singleton3 getInstance(){
		if(singleton == null){
			synchronized(Singleton3.class){
				if(singleton == null){
					singleton = new Singleton3();
				}
			}
		}
		return singleton;
	}
}

```

> ***\*å‡ ç§æ¨¡å¼çš„æ¯”è¾ƒï¼š\****
>
> 
>
> ***\*1ã€é¥¿æ±‰æ¨¡å¼\****æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ä¾‹å¯¹è±¡åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­å°±ä¼šè¢«åˆ›å»ºï¼Œåœ¨getInstance()æ–¹æ³•ä¸­åªæ˜¯ç›´æ¥è¿”å›å¯¹è±¡å¼•ç”¨ã€‚ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€œé¥¿æ±‰â€ï¼Œæ˜¯å› ä¸ºè¿™ç§æ¨¡å¼åˆ›å»ºå®ä¾‹å¯¹è±¡æ¯”è¾ƒâ€œæ€¥â€ï¼ŒçœŸçš„æ˜¯é¥¿åäº†â€¦â€¦
>
> å¥½å¤„ï¼šç®€å•æ˜äº†ï¼Œæ— éœ€å…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚
>
> ç¼ºç‚¹ï¼šå¦‚æœåœ¨ä¸€ä¸ªå¤§ç¯å¢ƒä¸‹ä½¿ç”¨äº†è¿‡å¤šçš„é¥¿æ±‰å•ä¾‹ï¼Œåˆ™ä¼šç”Ÿäº§å‡ºè¿‡å¤šçš„å®ä¾‹å¯¹è±¡ï¼Œæ— è®ºä½ æ˜¯å¦è¦ä½¿ç”¨ä»–ä»¬ã€‚
>
> ***\*2ã€é¥±æ±‰æ¨¡å¼\****ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šäº§ç”Ÿå®ä¾‹å¯¹è±¡ï¼Œç”Ÿäº§ä¹‹å‰ä¼šåˆ¤æ–­å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ºç©ºï¼Œè¿™é‡Œï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥åˆ¤æ–­ï¼Œå°±ä¼šç”Ÿæˆå¤šä¸ªå®ä¾‹å¯¹è±¡ï¼Œè¿™æ˜¯ä¸ç¬¦åˆå•ä¾‹çš„æ€æƒ³çš„ã€‚æ‰€ä»¥é¥±æ±‰æ¨¡å¼ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå°±ç”¨synchronizedå…³é”®å­—æ ‡è¯†äº†æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥è¢«ç§°ä¸ºâ€œé¥±æ±‰â€ï¼Œå› ä¸ºå®ƒå¾ˆé¥±ï¼Œä¸æ€¥ç€ç”Ÿäº§å®ä¾‹ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šç”Ÿäº§ã€‚
>
> å¥½å¤„ï¼šå»¶æ—¶åŠ è½½ï¼Œç”¨çš„æ—¶å€™æ‰ä¼šç”Ÿäº§å¯¹è±¡ã€‚
>
> ç¼ºç‚¹ï¼šéœ€è¦ä¿è¯åŒæ­¥ï¼Œä»˜å‡ºæ•ˆç‡çš„ä»£ä»·ã€‚
>
> ***\*3ã€åŒé‡é”æ¨¡å¼\****ï¼Œæ˜¯é¥±æ±‰æ¨¡å¼çš„ä¼˜åŒ–ï¼Œè¿›è¡ŒåŒé‡åˆ¤æ–­ï¼Œå½“å·²ç»åˆ›å»ºè¿‡å®ä¾‹å¯¹è±¡åå°±æ— éœ€åŠ é”ï¼Œæé«˜æ•ˆç‡ã€‚ä¹Ÿæ˜¯ä¸€ç§æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚

## redisé˜Ÿåˆ—å¦‚ä½•ä¿è¯ä»–çš„é«˜å¯ç”¨æ€§ï¼Ÿ

> ä¸ªäººç†è§£å°±æ˜¯å“¨å…µæ¨¡å¼+é›†ç¾¤å¯ä»¥è§£å†³å¤§å¤šæ•°çš„åœºæ™¯é—®é¢˜ã€‚
>
> å…³é”®å­—ï¼šmaster salver sentinel
> sentinelå¿…é¡»æ˜¯å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ç¥¨ï¼Œå½“æ£€æµ‹åˆ°masteræŒ‚äº†ä»¥åï¼Œè‡ªåŠ¨å¼€å§‹å‘é€‰ç¥¨ç»™salverï¼Œé€‰å‡ºæ–°çš„master

## innodbå’Œmyisam

> å…ˆå¼„æ˜ç™½ä»€ä¹ˆæ˜¯äºŒå‰æ ‘å’Œb+æ ‘

1. bæ ‘

> è¿™æ£µæ ‘çš„è¯ç”Ÿæ˜¯ä¸ºäº†è§£å†³æ‰äºŒå‰æ ‘é˜¶è¶Šé«˜ï¼ŒæŸ¥è¯¢ç£ç›˜çš„æ¬¡æ•°å°±è¶Šé«˜çš„é—®é¢˜

1.1 bæ ‘çš„è¯ç”Ÿè¿‡ç¨‹

![image-20200927113304754](/Users/juzelong/Documents/image-20200927113304754.png)

![image-20200927113316927](/Users/juzelong/Documents/image-20200927113316927.png)

![image-20200927113333597](/Users/juzelong/Documents/image-20200927113333597.png)

1.2 MyISAMç´¢å¼•å®ç°
![MyISAMä¸»é”®ç´¢å¼•](https://img-blog.csdn.net/20150527164101257)

> æœ¬äººè‡ªå·±çš„ç†è§£ï¼šmysiamç´¢å¼•å°±æ˜¯è‡ªå·±å°†æ•°æ®çš„åœ°å€å­˜äº†ä¸‹æ¥ï¼Œè°ƒçš„æ—¶å€™ç›´æ¥æ‰¾åœ°å€å°±å¥½äº†ï¼Œè¾…åŠ©ç´¢å¼•ä¹Ÿä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸»ç´¢å¼•ä¸èƒ½é‡å¤ï¼Œè¾…åŠ©ç´¢å¼•å¯ä»¥

1.3 InnoDB

![InnoDBä¸»ç´¢å¼•](https://img-blog.csdn.net/20150527165207200)

> æœ¬äººç†è§£ï¼šinnodbçš„ä¸»ç´¢å¼•æ˜¯å°†æ•°æ®å®Œæ•´çš„ä¿å­˜åœ¨äº†ç´¢å¼•å½“ä¸­(å› æ­¤ç§°ä¹‹ä¸ºèšæ—ç´¢å¼•)ï¼Œè°ƒçš„æ—¶å€™ç›´æ¥æ‹¿æ•°æ®ï¼Œè€Œè¾…åŠ©ç´¢å¼•æ˜¯è®°å½•äº†ä¸»ç´¢å¼•çš„å€¼ï¼Œå› æ­¤ä¸è¦ç”¨é•¿å­—æ®µåšç´¢å¼•

## å¦‚ä½•é˜²æ­¢è¶…å–

> ç®€å•æ¥è¯´å°±æ˜¯åŠ ä¸ªversionçš„ä¹è§‚é”å°±å¯ä»¥äº†
>
> æŸ¥çš„æ—¶å€™å…ˆæŠŠversionæŸ¥å‡ºæ¥ï¼Œæ›´æ–°çš„æ—¶å€™å¸¦versionæŸ¥ï¼ŒæŸ¥ä¸åˆ°æŠ›ä¸ªé”™å°±ç»“æŸäº†

## å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§

> ç½‘ä¸Šçš„è¯´æ³•å¾ˆå¤šï¼Œ
>
> 1.ä¹è§‚é”
>
> 2.é˜²é‡è¡¨
>
> 3.åˆ†å¸ƒå¼é”
>
> 4.token
>
> ä½†æ˜¯æ‰€æœ‰çš„è¯´æ³•éƒ½æ˜¯å›´ç»•ç€ä¸€ä¸ªå­—ï¼šé”ï¼Œæ¥å±•å¼€çš„ï¼ŒåŸºæœ¬å¥—è·¯å°±æ˜¯å‘é€è¯·æ±‚å‰å°±æŠŠèµ„æºæ”¾è¿›redisï¼Œç„¶åå¦å¤–ä¸€ä¸ªæœåŠ¡å™¨æ‹¿åˆ°æ•°æ®çš„æ—¶å€™éªŒè¯è¿™ä¸ªèµ„æºã€‚

> è¿™é‡Œæ’ä¸€å¥ï¼šå¦‚ä½•è§£å†³æ‰å¿«é€Ÿçš„é‡å¤æäº¤
>
> csrfï¼Œæ¸²æŸ“æ¨¡ç‰ˆçš„æ—¶å€™ç»™ä¸ªtokenï¼Œsessionæˆ–è€…redisé‡Œä¹ŸåŠ ä¸€ä¸ªï¼Œåç«¯å¯¹æ¯”æäº¤è¿‡æ¥çš„tokenï¼Œä¸€æ ·å°±æ‰§è¡Œï¼Œåˆ æ‰ï¼Œä¸ä¸€æ ·æˆ–è€…ä¸å­˜åœ¨å°±æ˜¯é‡å¤çš„æäº¤ã€‚

## å¦‚ä½•è§£å†³ä¾›è´§å•†å†™äº†æœ‰è´§ï¼Œä¸‹å•äº†å´æ²¡è´§çš„é—®é¢˜

> æŒ–ä¸ªå‘

## ç»§ç»­æˆ‘çš„springä¹‹æ—…

1. iocçš„å®Œå…¨ä½“å½¢æ€

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">
    <!-- ä½¿ç”¨springæ¥åˆ›å»ºå¯¹è±¡ -->
    <bean id="mysql" class="Dao.UserDaoMysqlImpl" />
    <bean id="oracle" class="Dao.UserDaoOracleImpl" />
    <bean id="userService" class="Service.UserServiceImpl">
        <property name="userDao" ref="oracle" />
    </bean>
</beans>
```

```java
import Service.UserServiceImpl;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

public class testUserService {

    public static void main(String[] args) {

        //è·å–springçš„ä¸Šä¸‹æ–‡å¯¹è±¡
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        UserServiceImpl userService1 = (UserServiceImpl) context.getBean("userService");
        userService1.getUser();


    }
}
```

> è¿™ç§æ–¹å¼ï¼Œåªéœ€è¦æ”¹xmlï¼Œä»£ç ä¸éœ€è¦åšä»»ä½•äº‹æƒ…

> å°çŸ¥è¯†ç‚¹ï¼šSpringä¼šåœ¨å¯åŠ¨çš„æ—¶å€™åŠ è½½æ‰€æœ‰åœ¨xmlä¸­çš„ç±»

2. springçš„é…ç½®

```xml
    <bean id="userT" class="com.ju.pojo.UserT" name="user2,u3,u4">
        <constructor-arg name="name" value="play" />
    </bean>
```

![image-20200927172511479](/Users/juzelong/Documents/image-20200927172511479.png)

# 2020.9.28 Springæ³¨è§£å’Œé™æ€ä»£ç†

## lavarelçš„ç”Ÿå‘½å‘¨æœŸ

![å¤„ç†è¯·æ±‚åˆ°å“åº”è¿‡ç¨‹](https://upload-images.jianshu.io/upload_images/2119758-ae9730b03f6ce607.png?imageMogr2/auto-orient/strip)

## springä¸­å„ç§å±æ€§ä¾èµ–æ³¨å…¥çš„æ–¹å¼

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd">
  
    <!-- ä½¿ç”¨springæ¥åˆ›å»ºå¯¹è±¡ -->
    <bean id="address" class="com.ju.pojo.Address" >
        <property name="address" value="ä¸Šæµ·"/>
    </bean>
    <bean id="student" class="com.ju.pojo.Student">
        <property name="name" value="juzelong1"/>
        <property name="address" ref="address"/>
        <property name="books">
            <array>
                <value>çº¢æ¥¼æ¢¦</value>
                <value>ä¸‰å›½æ¼”ä¹‰</value>
            </array>
        </property>
        <property name="hobbies">
            <list>
                <value>å†™ä»£ç </value>
                <value>å¬æ­Œ</value>
            </list>
        </property>
        <property name="card">
            <map>
                <entry key="1" value="ä¸­å›½é“¶è¡Œ"/>
                <entry key="2" value="å·¥å•†é“¶è¡Œ"/>
            </map>
        </property>
        <property name="games">
            <set>
                <value>lol</value>
                <value>bob</value>
            </set>
        </property>
        <property name="wife">
            <null/>
        </property>
        <property name="info">
            <props>
                <prop key="driver">123</prop>
                <prop key="url">www.baidu.com</prop>
            </props>
        </property>
    </bean>

</beans>
```

```java
package com.ju.pojo;

@Data
public class Address {
    private String address;

   
}

```

```java
package com.ju.pojo;

import java.util.*;

@Data
public class Student {
    private String name;
    private Address address;
    private String[] books;
    private List<String> hobbies;
    private Map<String, String> card;
    private Set<String> games;
    private String wife;
    private Properties info;

    
}

```

## Springä¸­çš„æ³¨è§£å¼€å‘

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        https://www.springframework.org/schema/context/spring-context.xsd">

    <!-- å¼€å¯æ³¨è§£æ”¯æŒ -->
    <context:annotation-config/>

    <bean id="cat" class="com.ju.pojo.Cat"/>
    <bean id="dog" class="com.ju.pojo.Dog"/>
    <bean id="person" class="com.ju.pojo.Person"/>


</beans>
```

```java
package com.ju.pojo;

import org.springframework.beans.factory.annotation.Autowired;

public class Person {
    @Autowired
    private Cat cat;
    @Autowired
    private Dog dog;
    private String name;

    public Cat getCat() {
        return cat;
    }

    public void setCat(Cat cat) {
        this.cat = cat;
    }

    public Dog getDog() {
        return dog;
    }

    public void setDog(Dog dog) {
        this.dog = dog;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

> ä»ä¸Šé¢å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œæ‰€æœ‰çš„ä¸œè¥¿ç”¨æ³¨è§£è‡ªåŠ¨è£…é…ï¼Œä¸éœ€è¦å†™ä»»ä½•çš„é¢å¤–xml

> @Resourceå’Œ@Autowiredçš„åŒºåˆ«ï¼Œ
>
> @Autowiredæ˜¯æŒ‰ç…§nameæ¥é“¾æ¥
>
> @Resourceæ˜¯æŒ‰ç…§nameæ¥ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±æŒ‰ç…§ç±»æ¥æ‰¾

2. å…¶ä»–çš„æ³¨è§£å¦‚ä¸‹

```java
package com.ju.pojo;

import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;

@Component
@Scope("singleton")
public class User {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

```java
package com.ju.dao;

import org.springframework.stereotype.Repository;

@Repository
public class UserDao {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

```

```java
package com.ju.controller;

import org.springframework.stereotype.Controller;

@Controller
public class UserController {
}

```

```java
package com.ju.service;

import org.springframework.stereotype.Service;

@Service
public class UserService {
}

```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        https://www.springframework.org/schema/context/spring-context.xsd">

    <!-- è‡ªåŠ¨æ‰«æ -->
    <context:component-scan base-package="com.ju" />
    <!-- å¼€å¯æ³¨è§£æ”¯æŒ -->
    <context:annotation-config/>
</beans>
```

> æ³¨æ„ï¼Œå…¶å®@Repository @Service @Component @Controllerå…¶å®éƒ½æ˜¯ä¸€æ ·çš„åŠŸèƒ½ï¼Œåªæ˜¯ä¸é€šçš„æ¨¡å—ç”¨ä¸åŒçš„å•è¯æ¥çº¦æŸ
> @Scope("singleton") è¿™ä¸ªæ˜¯å•ä¾‹æ¨¡å¼çš„æ³¨è§£å†™æ³•

## é™æ€ä»£ç†æ¨¡å¼

> ä»£ç†æ¨¡å¼ï¼Œæ˜¯å®ç°spring aopçš„åº•å±‚é€»è¾‘

Client:

```java
public class Client {
    public static void main(String[] args) {
        Host host = new Host();
        Proxy proxy = new Proxy(host);
        proxy.rent();
    }
}
```

Host:

```java
public class Host implements Rent {

    public void rent() {
        System.out.println("æˆ¿ä¸œç§Ÿæˆ¿å­");
    }
}
```

Proxy:

```java
public class Proxy implements Rent {
    private Host host;

    public Proxy(Host host) {
        this.host = host;
    }

    public void rent() {
        look();
        this.host.rent();
    }

    public void look() {
        System.out.println("çœ‹çœ‹");
    }
}
```

Rent:

```java
public interface Rent {
    public void rent();
}
```

> æ€»çš„æ¥è¯´ï¼Œä»£ç†æ¨¡å¼å°±æ˜¯ä¸ºäº†å„å¸å…¶èŒï¼Œè®©åº•å±‚çš„ç±»å’Œä¸šåŠ¡ç±»å½»åº•è§£å¶ã€‚åº•å±‚ç±»ä¸ç”¨å…³æ³¨å…¬å…±çš„äº‹ä»¶ï¼Œåªéœ€è¦åšå¥½è‡ªå·±çš„äº‹æƒ…å°±å¯ä»¥äº†ã€‚

# 2020.9.29 springAOP

## åŠ¨æ€ä»£ç†

ä»£ç†ç±»æ ¸å¿ƒ

```java
package demo2;

import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

public class ProxyInvocationHandle implements InvocationHandler {

    private Object target;

    //ä»£ç†è°
    public void setTarget(Object target) {
        this.target = target;
    }

    //è·å¾—ä»£ç†
    public Object getProxy() {
        return Proxy.newProxyInstance(this.getClass().getClassLoader(), target.getClass().getInterfaces(), this);
    }

    //ç”Ÿæˆä»£ç†
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        log(method.getName());
        return method.invoke(target, args);
    }

    //åŠ å…¥aopæ–¹æ³•
    public void log(String msg) {
        System.out.println("æ‰§è¡Œäº†"+ msg + "æ–¹æ³•");
    }
}
```

è¢«ä»£ç†çš„çœŸå®ç±»

```java
package demo2;

import demo1.Rent;

public class Host implements Rent {

    public void rent() {
        System.out.println("æˆ¿ä¸œç§Ÿæˆ¿å­");
    }
}
```

çœŸå®ç±»çš„æŠ½è±¡æ¥å£

```java
package demo2;

public interface Rent {
    public void rent();
}
```

å®¢æˆ·ç«¯è°ƒç”¨

```java
package demo2;

import demo1.Rent;

public class Client {
    public static void main(String[] args) {
        Host host = new Host();
        ProxyInvocationHandle proxyInvocationHandle = new ProxyInvocationHandle();
        proxyInvocationHandle.setTarget(host);
        Rent rent = (Rent) proxyInvocationHandle.getProxy();
        rent.rent();
    }
}
```

> è¿™æ ·å°±æ˜ç™½äº†ï¼ŒaopçœŸæ­£çš„åšæ³•æ˜¯ä»€ä¹ˆï¼Œä¸»è¦æ˜¯å…ˆæœ‰æ¥å£ï¼Œåæœ‰å®ç°ï¼Œç„¶åå»ºç«‹åŠ¨æ€ä»£ç†ç±»ï¼Œå°†å®ç°ä¸¢ç»™ä»£ç†ç±»ï¼Œå †ç Œaopä»£ç ï¼Œå†è¿”å›å‡ºæ¥ï¼Œå°±å¯ä»¥åšå‡ºæ•ˆæœ
>
> **åŠ¨æ€ä»£ç†ï¼Œä»£ç†çš„æ˜¯æŸä¸€ç±»ä¸šåŠ¡çš„ä¸€ä¸ªæ¥å£**
>
> **é™æ€ä»£ç†ï¼Œä»£ç†çš„æ˜¯æŸä¸€ä¸ªç±»**

![image-20200929110019688](/Users/juzelong/Documents/image-20200929110019688.png)

## springAOPå®ç°

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        https://www.springframework.org/schema/aop/spring-aop.xsd">

    <!-- ä½¿ç”¨springæ¥åˆ›å»ºå¯¹è±¡ -->
    <bean id="userService" class="com.ju.service.userServiceImpl" />
    <bean id="log" class="com.ju.log.log" />
    <bean id="aftertLog" class="com.ju.log.AftertLog" />
    <bean id="diy" class="com.ju.diy.diy" />

    <!-- æ–¹å¼ä¸€ åŸç”Ÿspring apiæ¥å£ -->
    <!--  aopçš„çº¦æŸ -->
<!--    <aop:config>-->
<!--        åˆ‡å…¥ç‚¹ -->
<!--        <aop:pointcut id="pointcut" expression="execution(* com.ju.service.userServiceImpl.*(..))"/>-->
<!--        <aop:advisor advice-ref="log" pointcut-ref="pointcut"/>-->
<!--        <aop:advisor advice-ref="aftertLog" pointcut-ref="pointcut"/>-->
<!--    </aop:config>-->


<!-- æ–¹å¼äºŒï¼Œè‡ªå®šä¹‰ç±»è¿›è¡Œaopåˆ‡é¢ -->
<!--    <bean id="diy" class="com.ju.diy.diy" />-->
<!--    <aop:config>-->
<!--         è‡ªå®šä¹‰åˆ‡é¢ -->
<!--        <aop:aspect ref="diy">-->
<!--            &lt;!&ndash; åˆ‡å…¥ç‚¹ &ndash;&gt;-->
<!--            <aop:pointcut id="point" expression="execution(* com.ju.service.userServiceImpl.*(..))"/>-->
<!--            <aop:before method="before" pointcut-ref="point"/>-->
<!--            <aop:after method="after" pointcut-ref="point"/>-->
<!--        </aop:aspect>-->
<!--    </aop:config>-->


    <!-- æ–¹å¼ä¸‰ æ³¨è§£æ–¹å¼ -->
    <aop:aspectj-autoproxy/>
</beans>
```

```java
package com.ju.log;

import org.springframework.aop.MethodBeforeAdvice;

import java.lang.annotation.Target;
import java.lang.reflect.Method;

//æ™®é€šæ¨¡å¼
public class log implements MethodBeforeAdvice {

    public void before(Method method, Object[] objects, Object target) throws Throwable {
        System.out.println(target.getClass().getName()+ "çš„" + method.getName() + "è¢«æ‰§è¡Œäº†");
    }
}
```

```java
package com.ju.log;

import org.springframework.aop.AfterAdvice;
import org.springframework.aop.AfterReturningAdvice;

import java.lang.reflect.Method;
//æ™®é€šæ¨¡å¼
public class AftertLog implements AfterReturningAdvice {

    public void afterReturning(Object o, Method method, Object[] objects, Object target) throws Throwable {
        System.out.println(target.getClass().getName()+ "çš„" + method.getName() + "è¢«æ‰§è¡Œäº†");
    }
}
```

```java
package com.ju.diy;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.After;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;


// æ³¨è§£ä¸è‡ªå®šä¹‰æ¨¡å¼ ä¸åŠ æ³¨è§£å°±æ˜¯è‡ªå®šä¹‰æ¨¡å¼
@Aspect
public class diy {

    @Before("execution(* com.ju.service.userServiceImpl.*(..))")
    public void before() {
        System.out.println("æ–¹æ³•æ‰§è¡Œå‰");
    }

    @After("execution(* com.ju.service.userServiceImpl.*(..))")
    public void after() {
        System.out.println("æ–¹æ³•æ‰§è¡Œå");
    }

    @Around("execution(* com.ju.service.userServiceImpl.*(..))")
    public void around(ProceedingJoinPoint pj) throws Throwable {

        System.out.println("===ç¯ç»•å¼€å§‹===");

        System.out.println(pj.getSignature());
        Object proceed = pj.proceed();

        System.out.println("===ç¯ç»•ç»“æŸ===");

        System.out.println(proceed);

    }
}

```

```java
import com.ju.service.userService;
import com.ju.service.userServiceImpl;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

//è°ƒç”¨
public class myTest {
    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        //springä¸­æ˜¯åŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥åªä¼šä»£ç†æ¥å£
        userService userService = (userService)context.getBean("userService");
        userService.add();
    }
}
```

> ä¸ªäººè§‚ç‚¹ï¼Œæ³¨é‡Šæ¯”è¾ƒç®€å•ï¼Œå°é¡¹ç›®å¯ä»¥ç”¨ï¼Œå¤§é¡¹ç›®å¯ä»¥ç”¨ç¬¬äºŒç§ï¼Œç¬¬ä¸€ç§è¿‡äºæ­»æ¿å’Œ



![image-20200929144519199](/Users/juzelong/Documents/image-20200929144519199.png)

> 10.1åœ¨å®¶æŠŠå‰©ä¸‹çš„mybatisæ•´åˆä»¥åŠspringmvcçœ‹å®Œï¼Œspringbootå¹´å‰è¿‡å®Œï¼Œé‚£1å¹´å¤šçš„javaä¾¿ä¸ç®—æ˜¯ç™½å­¦ï¼

## ä¸‹äº†ä¸ªé¢è¯•è§†é¢‘

> 360å¤§ç‰›å…¨é¢è§£è¯»PHPé¢è¯•

# 2020.9.31

> ç»™äºˆäº†æˆ‘ä¸ªä»»åŠ¡ï¼Œä¸»è¦çš„ç›®çš„æ˜¯äº†è§£ä»¥å‰çš„ç‡ƒæ°”äº‘ä¸šåŠ¡å¹¶è®¾è®¡å‡ºä¸€å¥—æœ‰è‡ªå·±æ€è·¯çš„æ¶æ„ä½“ç³»ï¼Œæ„Ÿè§‰æœ‰ç‚¹å°é¸­æ¢¨ã€‚



## æ³¨å†ŒæœåŠ¡

### åŸä¸šåŠ¡

1. æ³¨å†Œ

   1. t_vcc_user_accountè´¦å·è¡¨ï¼Œæµç¨‹æ˜¯æ‹¿åˆ°æ‰‹æœºå·å’Œuser_idæ¥æ¯”å¯¹ï¼Œå¦‚æœå¯¹ä¸ä¸Šç›´æ¥æŠ›é”™ã€‚
   2. æ‹¿æ‰‹æœºç›´æ¥å»åº“é‡ŒæŸ¥ï¼Œå¦‚æœå·®ä¸å¤šæ³¨å†Œï¼Œå¦‚æœæŸ¥åˆ°äº†å°±ç»™ä¸ªæ ‡ç¤ºç»§ç»­å‘ä¸‹ã€‚

   ```sql
   SELECT
   	u.id,
   	u.browser,
   	u.count,
   	u.create_time,
   	u.default_org_id,
   	u.ip,
   	u.last_login_time,
   	u.state,
   	u.mobile
   FROM
   	t_vcc_user u,
   	t_vcc_user_account ua
   WHERE
   	u.ID = ua.user_id
   AND ua.state = 'A'
   AND ua.type = :type
   AND ua.account = :account
   ```

   ```java
   if (userPojo != null) {
               	userPojo.setMobile(userInfo.getMobile());
                   MemberPojo memberPojo = userService.getMemberByUserId(userPojo.getId());
                   // æ°”æˆ·ç®¡ç†åˆ é™¤ä¼šå‘˜
                   if (memberPojo == null) {
                       memberPojo = BeanTransformUtil.userInfo2Member(userInfo, memberPojo);
                       memberPojo.setUserId(userPojo.getId());
                       memberPojo.setCode(account);
                       userService.save(memberPojo);
                   }
                   else {
                       logger.info(memberPojo.toString());
                       BeanTransformUtil.userInfo2Member(userInfo, memberPojo);
                       userService.updateEntity(memberPojo);
                   }
               }
               else {
                   // æ–°å»ºè´¦æˆ·
                   userPojo = BeanTransformUtil.userInfo2User(userInfo, null);
                   if (CommonContant.ACCT_TYPE_MOBILE.equals(accountType)) {
                       userPojo.setState(CommonContant.AVALIABLE);
                   }
                   userService.save(userPojo);
   
                   MemberPojo memberPojo = BeanTransformUtil.userInfo2Member(userInfo, null);
                   memberPojo.setUserId(userPojo.getId());
                   memberPojo.setCode(account);
                   userService.save(memberPojo);
   
                   addAccount(userPojo.getId(), account, accountType, null);
               }
   ```

   3. å…³äºæ·»åŠ ç”¨æˆ·

   > æš‚åœï¼Œè¿˜æ˜¯å…ˆæŠŠåŸºç¡€è¡¥å®Œå†æ¥å§ã€‚



# 2020.10.5 springMVC

## servlet

1. ä¸»è¦ä¾èµ–

```xml
<dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.12</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>5.2.9.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.5</version>
        </dependency>
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>jsp-api</artifactId>
            <version>2.2</version>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>jstl</artifactId>
            <version>1.2</version>
        </dependency>
    </dependencies>
```

2. åˆ›å»ºé¡¹ç›®å¹¶è®¾ç½®ä»–ä¸ºwebé¡¹ç›®

![image-20201006165757995](/Users/juzelong/Documents/image-20201006165757995.png)

3. åˆ›å»ºå®Œæ¯•åï¼Œä¼šå‡ºç°webinfæ–‡ä»¶å¤¹

![image-20201006165905546](/Users/juzelong/Documents/image-20201006165905546.png)

4. ç»§æ‰¿sevrletç±»å¹¶é‡å†™æ–¹æ³•

![image-20201006170030703](/Users/juzelong/Documents/image-20201006170030703.png)

5. web.xmlæ·»åŠ é…ç½®

```xml
    <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.ju.servlet.HelloServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
```

6. æ·»åŠ tomcatæœåŠ¡å™¨

![image-20201006170132326](/Users/juzelong/Documents/image-20201006170132326.png)

7. æ·»åŠ jspé¡µé¢

![image-20201006170220043](/Users/juzelong/Documents/image-20201006170220043.png)

8. æ•ˆæœ:

![image-20201006170248164](/Users/juzelong/Documents/image-20201006170248164.png)

































